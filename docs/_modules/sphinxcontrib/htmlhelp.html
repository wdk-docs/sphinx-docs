
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <title>sphinxcontrib.htmlhelp &#8212; Sphinx 2.1.0+/cb9d9e59e 文档</title>
    <link rel="stylesheet" href="../../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx 2.1.0+/cb9d9e59e 文档 中搜索"
          href="../../_static/opensearch.xml"/>

    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
<link rel="canonical" href="http://www.sphinx-doc.org/en/master/_modules/sphinxcontrib/htmlhelp.html" />

<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css' />
 
<style type="text/css">
  table.right {
    float: right;
    margin-left: 20px;
  }

  table.right td {
    border: 1px solid #ccc;
  }

    {
    % if pagename=='index'%
  }

  .related {
    display: none;
  }

    {
    % endif %
  }
</style>
<script type="text/javascript">
  // intelligent scrolling of the sidebar content
  $(window).scroll(function () {
    var sb = $('.sphinxsidebarwrapper');
    var win = $(window);
    var sbh = sb.height();
    var offset = $('.sphinxsidebar').position()['top'];
    var wintop = win.scrollTop();
    var winbot = wintop + win.innerHeight();
    var curtop = sb.position()['top'];
    var curbot = curtop + sbh;
    // does sidebar fit in window?
    if (sbh < win.innerHeight()) {
      // yes: easy case -- always keep at the top
      sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
        $(document).height() - sbh - 200
      ]));
    } else {
      // no: only scroll if top/bottom edge of sidebar is at
      // top/bottom edge of window
      if (curtop > wintop && curbot > winbot) {
        sb.css('top', $u.max([wintop - offset - 10, 0]));
      } else if (curtop < wintop && curbot < winbot) {
        sb.css('top', $u.min([winbot - sbh - offset - 20,
          $(document).height() - sbh - 200
        ]));
      }
    }
  });
</script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../index.html">主页</a></li>
    <li><a href="../../usage/installation.html">安装</a></li>
    <li><a href="../../contents.html">文档</a></li>
    <li><a href="../../develop.html">扩展/开发</a></li>
  </ul>
  <div>
    <a href="../../index.html">
      <img src="../../_static/sphinxheader.png" alt="SPHINX" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
<li><a href="../../index.html">主页</a>&#160;|</li>
<li><a href="../../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">模块代码</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>sphinxcontrib.htmlhelp 源代码</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sphinxcontrib.htmlhelp</span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">    Build HTML help support files.</span>

<span class="sd">    :copyright: Copyright 2007-2019 by the Sphinx team, see README.</span>
<span class="sd">    :license: BSD, see LICENSE for details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">IO</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">docutils</span> <span class="k">import</span> <span class="n">nodes</span>
<span class="kn">from</span> <span class="nn">docutils.nodes</span> <span class="k">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">document</span>

<span class="kn">from</span> <span class="nn">sphinx</span> <span class="k">import</span> <span class="n">addnodes</span>
<span class="kn">from</span> <span class="nn">sphinx.application</span> <span class="k">import</span> <span class="n">Sphinx</span>
<span class="kn">from</span> <span class="nn">sphinx.builders.html</span> <span class="k">import</span> <span class="n">StandaloneHTMLBuilder</span>
<span class="kn">from</span> <span class="nn">sphinx.config</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">sphinx.deprecation</span> <span class="k">import</span> <span class="n">RemovedInSphinx40Warning</span>
<span class="kn">from</span> <span class="nn">sphinx.environment.adapters.indexentries</span> <span class="k">import</span> <span class="n">IndexEntries</span>
<span class="kn">from</span> <span class="nn">sphinx.locale</span> <span class="k">import</span> <span class="n">get_translation</span>
<span class="kn">from</span> <span class="nn">sphinx.util</span> <span class="k">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">sphinx.util</span> <span class="k">import</span> <span class="n">progress_message</span>
<span class="kn">from</span> <span class="nn">sphinx.util.fileutil</span> <span class="k">import</span> <span class="n">copy_asset_file</span>
<span class="kn">from</span> <span class="nn">sphinx.util.nodes</span> <span class="k">import</span> <span class="n">NodeMatcher</span>
<span class="kn">from</span> <span class="nn">sphinx.util.osutil</span> <span class="k">import</span> <span class="n">make_filename_from_project</span><span class="p">,</span> <span class="n">relpath</span>
<span class="kn">from</span> <span class="nn">sphinx.util.template</span> <span class="k">import</span> <span class="n">SphinxRenderer</span>

<span class="kn">from</span> <span class="nn">sphinxcontrib.htmlhelp.version</span> <span class="k">import</span> <span class="n">__version__</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">__</span> <span class="o">=</span> <span class="n">get_translation</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;console&#39;</span><span class="p">)</span>

<span class="n">package_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">template_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>


<span class="c1"># The following list includes only languages supported by Sphinx. See</span>
<span class="c1"># https://docs.microsoft.com/en-us/previous-versions/windows/embedded/ms930130(v=msdn.10)</span>
<span class="c1"># for more.</span>
<span class="n">chm_locales</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># lang:   LCID,  encoding</span>
    <span class="s1">&#39;ca&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x403</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;cs&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x405</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;da&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x406</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;de&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x407</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;en&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x409</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;es&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x40a</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;et&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x425</span><span class="p">,</span> <span class="s1">&#39;cp1257&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fa&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x429</span><span class="p">,</span> <span class="s1">&#39;cp1256&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fi&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x40b</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fr&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x40c</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;hr&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x41a</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;hu&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x40e</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;it&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x410</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;ja&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x411</span><span class="p">,</span> <span class="s1">&#39;cp932&#39;</span><span class="p">),</span>
    <span class="s1">&#39;ko&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x412</span><span class="p">,</span> <span class="s1">&#39;cp949&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lt&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x427</span><span class="p">,</span> <span class="s1">&#39;cp1257&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lv&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x426</span><span class="p">,</span> <span class="s1">&#39;cp1257&#39;</span><span class="p">),</span>
    <span class="s1">&#39;nl&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x413</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;no_NB&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x414</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;pl&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x415</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;pt_BR&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x416</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;ru&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x419</span><span class="p">,</span> <span class="s1">&#39;cp1251&#39;</span><span class="p">),</span>
    <span class="s1">&#39;sk&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x41b</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;sl&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x424</span><span class="p">,</span> <span class="s1">&#39;cp1250&#39;</span><span class="p">),</span>
    <span class="s1">&#39;sv&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x41d</span><span class="p">,</span> <span class="s1">&#39;cp1252&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tr&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="mh">0x41f</span><span class="p">,</span> <span class="s1">&#39;cp1254&#39;</span><span class="p">),</span>
    <span class="s1">&#39;uk_UA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x422</span><span class="p">,</span> <span class="s1">&#39;cp1251&#39;</span><span class="p">),</span>
    <span class="s1">&#39;zh_CN&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x804</span><span class="p">,</span> <span class="s1">&#39;cp936&#39;</span><span class="p">),</span>
    <span class="s1">&#39;zh_TW&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mh">0x404</span><span class="p">,</span> <span class="s1">&#39;cp950&#39;</span><span class="p">),</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">chm_htmlescape</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quote</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    chm_htmlescape() is a wrapper of html.escape().</span>
<span class="sd">    .hhc/.hhk files don&#39;t recognize hex escaping, we need convert</span>
<span class="sd">    hex escaping to decimal escaping. for example: ``&amp;#x27;`` -&gt; ``&amp;#39;``</span>
<span class="sd">    html.escape() may generates a hex escaping ``&amp;#x27;`` for single</span>
<span class="sd">    quote ``&#39;``, this wrapper fixes this.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;#x27;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;#39;&#39;</span><span class="p">)</span>    <span class="c1"># re-escape as decimal</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">ToCTreeVisitor</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[str]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">astext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unknown_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">unknown_departure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">visit_bullet_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;UL&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">depart_bullet_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/UL&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_list_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;LI&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">depart_list_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/LI&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">chm_htmlescape</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">astext</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;OBJECT type=&quot;text/sitemap&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  &lt;PARAM name=&quot;Name&quot; value=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;&#39;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  &lt;PARAM name=&quot;Local&quot; value=&quot;</span><span class="si">%s</span><span class="s1">&quot; /&gt;&#39;</span> <span class="o">%</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;refuri&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/OBJECT&gt;&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">nodes</span><span class="o">.</span><span class="n">SkipNode</span>


<div class="viewcode-block" id="HTMLHelpBuilder"><a class="viewcode-back" href="../../usage/builders/index.html#sphinx.builders.htmlhelp.HTMLHelpBuilder">[文档]</a><span class="k">class</span> <span class="nc">HTMLHelpBuilder</span><span class="p">(</span><span class="n">StandaloneHTMLBuilder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builder that also outputs Windows HTML help project, contents and</span>
<span class="sd">    index files.  Adapted from the original Doc/tools/prechm.py.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;htmlhelp&#39;</span>
    <span class="n">epilog</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">&#39;You can now run HTML Help Workshop with the .htp file in &#39;</span>
                <span class="s1">&#39;</span><span class="si">%(outdir)s</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="c1"># don&#39;t copy the reST source</span>
    <span class="n">copysource</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">supported_image_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">,</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">]</span>

    <span class="c1"># don&#39;t add links</span>
    <span class="n">add_permalinks</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># don&#39;t add sidebar etc.</span>
    <span class="n">embedded</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># don&#39;t generate search index or include search page</span>
    <span class="n">search</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">lcid</span> <span class="o">=</span> <span class="mh">0x409</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;cp1252&#39;</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># the output files for HTML help is .html by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_suffix</span> <span class="o">=</span> <span class="s1">&#39;.html&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_suffix</span> <span class="o">=</span> <span class="s1">&#39;.html&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="c1"># determine the correct locale setting</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="n">chm_locales</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">locale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lcid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">locale</span>

    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">basename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">:</span>
        <span class="c1"># open a file with the correct encoding for the selected language</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;HTMLHelpBuilder.open_file() is deprecated.&#39;</span><span class="p">,</span>
                      <span class="n">RemovedInSphinx40Warning</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">basename</span><span class="p">),</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;xmlcharrefreplace&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_page_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pagename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">templatename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">event_arg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOQA</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>

    <span class="k">def</span> <span class="nf">handle_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_stopword_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_project_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_toc_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_hhx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">htmlhelp_basename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">doctree</span><span class="p">:</span> <span class="n">document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">doctree</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">reference</span><span class="p">):</span>
            <span class="c1"># add ``target=_blank`` attributes to external links</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;internal&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;refuri&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_blank&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write_doc</span><span class="p">(</span><span class="n">docname</span><span class="p">,</span> <span class="n">doctree</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">SphinxRenderer</span><span class="p">(</span><span class="n">template_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="nd">@progress_message</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;copying stopword list&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">copy_stopword_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Copy a stopword list (.stp) to outdir.</span>

<span class="sd">        The stopword list contains a list of words the full text search facility</span>
<span class="sd">        shouldn&#39;t index.  Note that this list must be pretty small.  Different</span>
<span class="sd">        versions of the MS docs claim the file has a maximum size of 256 or 512</span>
<span class="sd">        bytes (including \r\n at the end of each line).  Note that &quot;and&quot;, &quot;or&quot;,</span>
<span class="sd">        &quot;not&quot; and &quot;near&quot; are operators in the search language, so no point</span>
<span class="sd">        indexing them even if we wanted to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_dir</span><span class="p">,</span> <span class="s1">&#39;project.stp&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">htmlhelp_basename</span> <span class="o">+</span> <span class="s1">&#39;.stp&#39;</span><span class="p">)</span>
        <span class="n">copy_asset_file</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="nd">@progress_message</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;writing project file&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">build_project_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a project file (.hhp) on outdir.&quot;&quot;&quot;</span>
        <span class="c1"># scan project files</span>
        <span class="n">project_files</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[str]</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
            <span class="n">dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">in_staticdir</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="s1">&#39;_static&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">in_staticdir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">):</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fn</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>
                    <span class="n">project_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">htmlhelp_basename</span> <span class="o">+</span> <span class="s1">&#39;.hhp&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;xmlcharrefreplace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;outname&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">htmlhelp_basename</span><span class="p">,</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">html_title</span><span class="p">,</span>
                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                <span class="s1">&#39;lcid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcid</span><span class="p">,</span>
                <span class="s1">&#39;master_doc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">master_doc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_suffix</span><span class="p">,</span>
                <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="n">project_files</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;project.hhp&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

    <span class="nd">@progress_message</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;writing TOC file&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">build_toc_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a ToC file (.hhp) on outdir.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">htmlhelp_basename</span> <span class="o">+</span> <span class="s1">&#39;.hhc&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;xmlcharrefreplace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">toctree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_and_resolve_doctree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">master_doc</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                                                       <span class="n">prune_toctrees</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">visitor</span> <span class="o">=</span> <span class="n">ToCTreeVisitor</span><span class="p">(</span><span class="n">toctree</span><span class="p">)</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">NodeMatcher</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">compact_paragraph</span><span class="p">,</span> <span class="n">toctree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">toctree</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">matcher</span><span class="p">):</span>  <span class="c1"># type: addnodes.compact_paragraph</span>
                <span class="n">node</span><span class="o">.</span><span class="n">walkabout</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>

            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">visitor</span><span class="o">.</span><span class="n">astext</span><span class="p">(),</span>
                <span class="s1">&#39;suffix&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_suffix</span><span class="p">,</span>
                <span class="s1">&#39;short_title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">html_short_title</span><span class="p">,</span>
                <span class="s1">&#39;master_doc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">master_doc</span><span class="p">,</span>
                <span class="s1">&#39;domain_indices&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_indices</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;project.hhc&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">build_hhx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">outname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;writing index file...&#39;</span><span class="p">))</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">IndexEntries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">outname</span> <span class="o">+</span> <span class="s1">&#39;.hhk&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;xmlcharrefreplace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;UL&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">write_index</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">refs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">subitems</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># NOQA</span>
                <span class="k">def</span> <span class="nf">write_param</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;    &lt;param name=&quot;</span><span class="si">%s</span><span class="s1">&quot; value=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">chm_htmlescape</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;LI&gt; &lt;OBJECT type=&quot;text/sitemap&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">write_param</span><span class="p">(</span><span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">write_param</span><span class="p">(</span><span class="s1">&#39;See Also&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">write_param</span><span class="p">(</span><span class="s1">&#39;Local&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">refs</span><span class="p">):</span>
                        <span class="c1"># XXX: better title?</span>
                        <span class="n">write_param</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;[</span><span class="si">%d</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">write_param</span><span class="p">(</span><span class="s1">&#39;Local&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/OBJECT&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subitems</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;UL&gt; &#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">subitems</span><span class="p">:</span>
                        <span class="n">write_index</span><span class="p">(</span><span class="n">subitem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">subitem</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/UL&gt;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">subitems</span><span class="p">,</span> <span class="n">key_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">write_index</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">refs</span><span class="p">,</span> <span class="n">subitems</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/UL&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">default_htmlhelp_basename</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Better default htmlhelp_basename setting.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">make_filename_from_project</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;doc&#39;</span>


<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setup_extension</span><span class="p">(</span><span class="s1">&#39;sphinx.builders.html&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_builder</span><span class="p">(</span><span class="n">HTMLHelpBuilder</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_message_catalog</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">&#39;locales&#39;</span><span class="p">))</span>

    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;htmlhelp_basename&#39;</span><span class="p">,</span> <span class="n">default_htmlhelp_basename</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;htmlhelp_file_suffix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;htmlhelp_link_suffix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
        <span class="s1">&#39;parallel_read_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;parallel_write_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
<li><a href="../../index.html">主页</a>&#160;|</li>
<li><a href="../../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >模块代码</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2007-2019, Georg Brandl and the Sphinx team.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.0+/cb9d9e59e 创建。
    </div>
  </body>
</html>